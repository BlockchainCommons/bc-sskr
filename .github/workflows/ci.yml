name: Compilation & Tests
on: [push, pull_request]
jobs:
  build-macos:
    name: Build on MacOS
    runs-on: macos-latest
    steps:
      - name: Clone
        uses: actions/checkout@v3
        with:
          submodules: true
      - name: Install cppcheck
        run: brew install cppcheck
      - name: Install bc-crypto-base
        run: |
          cd deps/bc-crypto-base
          ./configure
          make
          sudo make install
      - name: Install bc-shamir
        run: |
          cd deps/bc-shamir
          ./configure
          make
          sudo make install
      - name: Analyse bc-sskr
        run: |
          ./configure
          make lint
      - name: Test bc-sskr
        run: make check
      - name: Install bc-sskr
        run: sudo make install
      - name: Check bc-sskr distribution
        run: |
          make distcheck
          make distclean

  build-linux:
    name: Build on Linux
    runs-on: ubuntu-latest
    steps:
      - name: Clone
        uses: actions/checkout@v3
        with:
          submodules: true
      - name: Install bc-crypto-base
        run: |
          cd deps/bc-crypto-base
          ./configure
          make
          sudo make install
      - name: Install bc-shamir
        run: |
          cd deps/bc-shamir
          ./configure
          make
          sudo make install
      - name: Test bc-sskr
        run: |
          ./configure
          make check
      - name: Install bc-sskr
        run: sudo make install
      - name: Check bc-sskr distribution
        run: |
          make distcheck
          make distclean
